(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-69055bdc"],{"0ebb":function(e,t,a){"use strict";a("39f6")},"37cd":function(e,t,a){"use strict";a.r(t);a("b0c0");var o=a("600d"),i=a("c2ec"),n=a("c1df"),s=a.n(n),r=a("f7e6"),l=a.n(r),c=a("cf45"),d=a("0340"),p=a("b116"),m={name:"diyDataHistory",i18n:a("89fe"),components:{reportTempleteModel:p.a},data:function(){return{pagination:{pageSize:15,showSizeChanger:!0},TempleteName:"",isMaskShow:!1,selectRow:0,selectCol:0,loadExecl:null,isLoadExecl:!1,exportName:"",json_fields_cn:{"数据名称":"DataName","设备":"DeviceName","数据值":"DataValue","数据单位":"DataUnit","记录时间":{field:"RecordTime",callback:function(e){var t=new Date(e);return Object(c.a)(t,"yyyy-MM-dd hh:mm:ss")}}},json_fields_en:{DataName:"DataName",DeviceName:"DeviceName",DataValue:"DataValue",DataUnit:"DataUnit",RecordTime:{field:"RecordTime",callback:function(e){var t=new Date(e);return Object(c.a)(t,"yyyy-MM-dd hh:mm:ss")}}},json_fields:{},json_meta:[[{" key ":" charset "," value ":" utf- 8 "}]],SelectDateType:"Month",SelectDevice:[],SelectDateRange:"",SelectAlarmData:7,deviceTreeData:[],AlarmDataTree:[],TimeGeList:[{value:1,name:"diyReport.TimeGeOneMin"},{value:2,name:"diyReport.TimeGeFiveMin"},{value:3,name:"diyReport.TimeGeTenMin"},{value:4,name:"diyReport.TimeGeTenFiveMin"},{value:5,name:"diyReport.TimeGeTenThreeMin"},{value:6,name:"diyReport.TimeGeTenOneHour"},{value:7,name:"diyReport.TimeGeTenOneDay"}],form:this.$form.createForm(this),messageShowLoad:!1,advanced:!0,refIconLoading:!1,templeteUuid:"",columns:[{slotName:"reporting.DataHistory.DeviceName",width:"10%",scopedSlots:{customRender:"serial",title:"reporting.DataHistory.DeviceName"},dataIndex:"DeviceName"},{width:"10%",slotName:"reporting.DataHistory.DataName",scopedSlots:{customRender:"serial",title:"reporting.DataHistory.DataName"},dataIndex:"DataName"},{width:"10%",slotName:"reporting.DataHistory.DataValue",scopedSlots:{customRender:"DataValue",title:"reporting.DataHistory.DataValue"},dataIndex:"DataValue"},{width:"10%",slotName:"reporting.DataHistory.DataUnit",scopedSlots:{customRender:"DataUnit",title:"reporting.DataHistory.DataUnit"},dataIndex:"DataUnit"},{width:"10%",slotName:"reporting.DataHistory.RecordTime",scopedSlots:{customRender:"RecordTime",title:"reporting.DataHistory.RecordTime"},dataIndex:"RecordTime"}],dataSource:[],conditionExpress:"",selectedRows:[],sheetOptions:{}}},authorize:{},mounted:function(){var e=this;this.sheetOptions={container:"luckysheetQuery",lang:"zh",plugins:["chart"],allowEdit:!1,showinfobar:!1,showtoolbar:!1},"CN"==this.$i18n.locale?(this.sheetOptions.lang="zh",this.json_fields=this.json_fields_cn):(this.sheetOptions.lang="en",this.json_fields=this.json_fields_en),this.exportName=this.$t("reporting.DataHistory.exportName")+"."+Object(c.a)(new Date,"yyyy-MM-dd hh:mm:ss")+".xlsx";luckysheet.destroy(),this.$nextTick((function(){e.luckysheetOpt=luckysheet.create(e.sheetOptions)}))},activated:function(){},filters:{formatDate:function(e){var t=new Date(e);return Object(c.a)(t,"yyyy-MM-dd hh:mm:ss")}},created:function(){var e=this;this.getMonitorTree();luckysheet.destroy(),this.$nextTick((function(){e.luckysheetOpt=luckysheet.create(e.sheetOptions)}))},watch:{$route:function(){luckysheet.destroy()}},methods:{loadTemplete:function(){this.$refs.reportTempleteModel.showModal()},onSelectTemplete:function(e){this.TempleteName=this.$t("diyReportTemplete.LoadTempleteName")+e.Name,this.templeteUuid=e.Uuid,this.LoadReportTemplete(e.Uuid)},onDateChange:function(e,t){this.SelectDateRange=t},onWeeklyDateChange:function(e,t){var a=s()(e).day(1).format("YYYY-MM-DD"),o=s()(e).day(7).format("YYYY-MM-DD");this.SelectDateRange=[a,o]},getMonitorTree:function(){var e=this;this.deviceTreeData=[],Object(o.g)().then((function(t){0==t.data.code&&(e.deviceTreeData=t.data.list)}))},exportExcelBtn:function(){Object(d.a)(luckysheet.getluckysheetfile(),this.exportName)},LoadReportTemplete:function(e){var t="/static/reportTemplete/"+e+".xlsx?"+(new Date).getMilliseconds(),a=e,o=this;l.a.transformExcelToLuckyByUrl(t,a,(function(e,t){null!=e.sheets&&0!=e.sheets.length&&(luckysheet.destroy(),o.sheetOptions.data=e.sheets,o.sheetOptions.title=e.info.name,o.sheetOptions.userInfo=e.info.name.creator,luckysheet.create(o.sheetOptions))}))},LoadRemoteReport:function(e){var t="/"+e+"?"+(new Date).getMilliseconds(),a=Object(c.a)(new Date,"yyyy-MM-dd hh:mm:ss"),o=this;l.a.transformExcelToLuckyByUrl(t,a,(function(e,t){null!=e.sheets&&0!=e.sheets.length&&(luckysheet.destroy(),o.sheetOptions.data=e.sheets,o.sheetOptions.title=e.info.name,o.sheetOptions.userInfo=e.info.name.creator,luckysheet.create(o.sheetOptions))}))},QueryHistoryDataList:function(){var e=this;""!=e.templeteUuid?Object(d.b)(luckysheet.getluckysheetfile(),(function(t){e.dataSource=[];var a={deviceList:e.SelectDevice,dataList:e.SelectAlarmData,dateRange:e.SelectDateRange,dateType:e.SelectDateType,timeIn:e.SelectAlarmData,tUuid:e.templeteUuid};""!=a.dateRange&&""!=a.dateRange[0]?""!=a.deviceList?0!=a.timeIn?(e.$message.loading({content:e.$t("diyReport.QueryLoading"),duration:0}),e.messageShowLoad=!0,Object(i.e)(a).then((function(t){if(0==t.data.code){e.$message.destroy(),e.LoadRemoteReport(t.data.path);var a=document.createElement("a");a.href=t.data.path,a.setAttribute("download",e.exportName),a.style.display="none",document.body.appendChild(a),setTimeout((function(){a.click(),document.body.removeChild(a)}),66)}e.messageShowLoad=!1})).catch((function(){e.messageShowLoad=!1,e.$message.destroy(),e.$message.error(e.$t("loginPage.serverError"),3)}))):e.$message.error(e.$t("diyReport.SelectInTips")):e.$message.error(e.$t("diyReport.SelectDeviceTips")):e.$message.error(e.$t("reporting.DataHistory.SelectDateError"))})):e.$message.error(e.$t("diyReportTemplete.TempleteEmpty"))}}},u=(a("c366"),a("2877")),y=Object(u.a)(m,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-card",[a("div",[a("a-form",{attrs:{layout:"horizontal"}},[a("div",{class:e.advanced?null:"fold"},[a("a-row",[a("a-col",{attrs:{md:8,sm:24}},[a("a-form-item",{attrs:{label:e.$t("reporting.AlarmHistory.DeviceList"),labelCol:{span:5},wrapperCol:{span:18,offset:1}}},[a("a-tree-select",{staticStyle:{width:"100%"},attrs:{"show-search":"","tree-node-filter-prop":"title","allow-clear":"","dropdown-style":{maxHeight:"400px",overflow:"auto"},"tree-data":e.deviceTreeData,"replace-fields":{value:"key",title:"text"},placeholder:e.$t("reporting.AlarmHistory.DeviceList"),"tree-default-expand-all":""},model:{value:e.SelectDevice,callback:function(t){e.SelectDevice=t},expression:"SelectDevice"}})],1)],1),a("a-col",{attrs:{md:8,sm:24}},[a("a-form-item",{attrs:{label:e.$t("diyReport.TimeGe"),labelCol:{span:5},wrapperCol:{span:18,offset:1}}},[a("a-select",{staticStyle:{width:"100%"},model:{value:e.SelectAlarmData,callback:function(t){e.SelectAlarmData=t},expression:"SelectAlarmData"}},e._l(e.TimeGeList,(function(t,o){return a("a-select-option",{key:o,attrs:{value:t.value}},[e._v(" "+e._s(e.$t(t.name))+" ")])})),1)],1)],1),a("a-col",{attrs:{md:8,sm:24}},[a("a-form-item",{attrs:{label:e.$t("reporting.AlarmHistory.DateType"),labelCol:{span:5},wrapperCol:{span:18,offset:1}}},[a("a-radio-group",{model:{value:e.SelectDateType,callback:function(t){e.SelectDateType=t},expression:"SelectDateType"}},[a("a-radio-button",{attrs:{value:"Day"}},[e._v(" "+e._s(e.$t("reporting.AlarmHistory.DateDayType"))+" ")]),a("a-radio-button",{attrs:{value:"Weekly"}},[e._v(" "+e._s(e.$t("reporting.AlarmHistory.DateWeeklyType"))+" ")]),a("a-radio-button",{attrs:{value:"Month"}},[e._v(" "+e._s(e.$t("reporting.AlarmHistory.DateMonthType"))+" ")]),a("a-radio-button",{attrs:{value:"Diy"}},[e._v(" "+e._s(e.$t("reporting.AlarmHistory.DateDiyType"))+" ")])],1)],1)],1)],1),a("a-row",[a("a-col",{attrs:{md:8,sm:24}},[a("a-form-item",{attrs:{label:e.$t("reporting.AlarmHistory.SelectDate"),labelCol:{span:5},wrapperCol:{span:18,offset:1}}},["Day"==e.SelectDateType?a("a-date-picker",{staticStyle:{width:"100%"},attrs:{size:"default",placeholder:e.$t("reporting.AlarmHistory.DateDayType")},on:{change:e.onDateChange}}):e._e(),"Month"==e.SelectDateType?a("a-month-picker",{staticStyle:{width:"100%"},attrs:{size:"default",placeholder:e.$t("reporting.AlarmHistory.DateMonthType")},on:{change:e.onDateChange}}):e._e(),"Weekly"==e.SelectDateType?a("a-week-picker",{staticStyle:{width:"100%"},attrs:{size:"default",placeholder:e.$t("reporting.AlarmHistory.DateWeeklyType")},on:{change:e.onWeeklyDateChange}}):e._e(),"Diy"==e.SelectDateType?a("a-range-picker",{attrs:{showTime:!0,size:"default"},on:{change:e.onDateChange}}):e._e()],1)],1),"Diy"==e.SelectDateType?a("a-col",{attrs:{md:4,sm:24}},[a("span",{staticStyle:{float:"right","margin-top":"3px"}},[a("a-button",{attrs:{disabled:e.messageShowLoad,type:"primary"},on:{click:e.QueryHistoryDataList}},[e._v(e._s(e.$t("reporting.AlarmHistory.Query")))])],1)]):a("a-col",{attrs:{md:2,sm:24}},[a("span",{staticStyle:{float:"right","margin-top":"3px"}},[a("a-button",{attrs:{disabled:e.messageShowLoad,type:"primary"},on:{click:e.QueryHistoryDataList}},[e._v(e._s(e.$t("reporting.AlarmHistory.Query")))])],1)]),a("a-col",{attrs:{md:2,sm:24}},[a("span",{staticStyle:{"margin-left":"10px",float:"left","margin-top":"3px"}},[a("a-button",{attrs:{type:"default",icon:"download"},on:{click:e.loadTemplete}},[e._v(e._s(e.$t("diyReportTemplete.Load")))])],1)]),a("a-col",{attrs:{md:10,sm:24}},[a("span",{staticStyle:{float:"right","margin-top":"3px"}},[""!=e.TempleteName?a("a-alert",{attrs:{message:e.TempleteName,type:"info","show-icon":""}}):e._e()],1)])],1)],1)])],1),a("div",{staticClass:"hello"},[a("div",{staticStyle:{margin:"0px",padding:"0px",height:"600px",width:"100%",left:"0px",top:"100px",bottom:"0px"},attrs:{id:"luckysheetQuery"}}),a("report-templete-model",{ref:"reportTempleteModel",on:{OnSelectTemplete:e.onSelectTemplete}})],1)])}),[],!1,null,null,null);t.default=y.exports},"39f6":function(e,t,a){},7983:function(e,t,a){},b116:function(e,t,a){"use strict";a("d3b7");var o=a("f64d"),i={name:"deviceDataModel",i18n:a("89fe"),data:function(){return{pagination:{pageSize:15,showSizeChanger:!0},loading:!1,addVisible:!1,columns:[{slotName:"diyReportTemplete.Name",width:"20%",scopedSlots:{customRender:"Name",title:"diyReportTemplete.Name"},dataIndex:"Name"},{width:"20%",slotName:"diyReportTemplete.Describe",scopedSlots:{customRender:"Describe",title:"diyReportTemplete.Describe"},dataIndex:"Describe"},{slotName:"configComponent.video.TableVideoOpt",width:"10%",scopedSlots:{customRender:"Opt",title:"configComponent.video.TableVideoOpt"}}],dataSource:[]}},watch:{$route:function(){}},mounted:function(){this.GetReportTempletes()},create:function(){this.GetReportTempletes()},methods:{showModal:function(){this.addVisible=!0,this.GetReportTempletes()},handleCancel:function(){this.addVisible=!1},SelectTemplete:function(e){this.$emit("OnSelectTemplete",e),this.addVisible=!1},GetReportTempletes:function(){var e=this;e.loading=!0,this.dataSource=[],Object(o.d)().then((function(t){e.loading=!1,0==t.data.code&&(null==t.data.list?e.dataSource=[]:e.dataSource=t.data.list)})).finally((function(t){e.loading=!1}))}}},n=(a("0ebb"),a("2877")),s=Object(n.a)(i,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-card",[a("a-modal",{directives:[{name:"drag-modal",rawName:"v-drag-modal"}],attrs:{width:"800px",footer:null,title:e.$t("diyReportTemplete.TempleteList")},model:{value:e.addVisible,callback:function(t){e.addVisible=t},expression:"addVisible"}},[a("a-spin",{attrs:{tip:"Loading...",spinning:e.loading}},[a("a-table",{attrs:{rowKey:"Name",pagination:e.pagination,columns:e.columns,"data-source":e.dataSource},scopedSlots:e._u([{key:"Status",fn:function(t){return a("span",{},[1==t?a("div",{staticStyle:{color:"#74f808"}},[e._v(" "+e._s(e.$t("configComponent.video.VideoOnline"))+" ")]):0==t?a("div",{staticStyle:{color:"#ea1111"}},[e._v(" "+e._s(e.$t("configComponent.video.VideoOffline"))+" ")]):e._e()])}},{key:"Opt",fn:function(t,o){return a("div",{},[a("a",{staticStyle:{cursor:"pointer",color:"#13C2C2"},attrs:{type:"link"},on:{click:function(t){return e.SelectTemplete(o)}}},[a("a-icon",{attrs:{type:"download"}}),a("span",{staticStyle:{"margin-left":"2px"}},[e._v(e._s(e.$t("diyReportTemplete.Load")))])],1)])}}])},[e._l(e.columns,(function(t,o){return a("template",{slot:t.slotName},[a("span",{key:o},[e._v(e._s(e.$t(t.slotName)))])])}))],2)],1)],1)],1)}),[],!1,null,"1d703557",null);t.a=s.exports},c366:function(e,t,a){"use strict";a("7983")}}]);