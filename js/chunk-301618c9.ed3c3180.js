(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-301618c9"],{"28be":function(e,t,a){},"29f1":function(e,t,a){"use strict";a("28be")},50927:function(e,t,a){"use strict";a.r(t);a("d3b7"),a("25f0"),a("b0c0");var r=a("c964"),s=(a("96cf"),a("7424")),n=a("b775");function o(e){return i.apply(this,arguments)}function i(){return(i=Object(r.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(n.g)(s.DBBACKUP,n.b.POST,t,{timeout:6e5}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function c(e){return l.apply(this,arguments)}function l(){return(l=Object(r.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(n.g)(s.GETTABLESLIST,n.b.POST,t,{timeout:6e5}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function u(e){return d.apply(this,arguments)}function d(){return(d=Object(r.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(n.g)(s.GETBACKUPLIST,n.b.POST,t,{timeout:6e5}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return p.apply(this,arguments)}function p(){return(p=Object(r.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(n.g)(s.DBRESTORE,n.b.POST,t,{timeout:36e5}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return g.apply(this,arguments)}function g(){return(g=Object(r.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(n.g)(s.DBDOWN,n.b.POST,t,{timeout:36e5}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return h.apply(this,arguments)}function h(){return(h=Object(r.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(n.g)(s.GETDBCONFIG,n.b.POST,t,{timeout:6e5}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(e){return k.apply(this,arguments)}function k(){return(k=Object(r.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(n.g)(s.SETDBCONFIG,n.b.POST,t,{timeout:6e5}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var S={i18n:a("89fe"),data:function(){return{checkAll:!0,messageShowLoad:!1,indeterminate:!1,SystemTables:[],DbType:"1",DbConfig:{},localUpgradeUrl:s.SQLUPLOAD,GetTables:[],Configuring:!1,form:this.$form.createForm(this),BackupList:[],pagination:{pageSize:15,showSizeChanger:!0},columns:[{width:"20%",slotName:"DbBack.Name",scopedSlots:{customRender:"FileName",title:"DbBack.Name"},dataIndex:"FileName"},{slotName:"DbBack.BackUpTime",width:"20%",scopedSlots:{customRender:"CreateTime",title:"DbBack.BackUpTime"},dataIndex:"CreateTime"},{slotName:"DbBack.FileSize",width:"20%",scopedSlots:{customRender:"FileSize",title:"DbBack.FileSize"},dataIndex:"FileSize"},{slotName:"configComponent.video.TableVideoOpt",width:"10%",scopedSlots:{customRender:"Opt",title:"configComponent.video.TableVideoOpt"}}]}},components:{},mounted:function(){this.GetDbConfig()},methods:{chargeDb:function(e){this.DbType=e},onCheckAllChange:function(e){Object.assign(this,{GetTables:e.target.checked?this.SystemTables:[],indeterminate:!1,checkAll:e.target.checked})},onChange:function(e){this.indeterminate=!!e.length&&e.length<this.SystemTables.length,this.checkAll=e.length===this.SystemTables.length},BackUp:function(){var e=this;if(0!=this.GetTables.length){var t={tables:this.GetTables};this.messageShowLoad=!0,o(t).then((function(t){0==t.data.code?e.$message.success(e.$t("DbBack.BackupsSuccess")):e.$message.error(e.$t("DbBack.BackupsFailed"))})).finally((function(t){e.messageShowLoad=!1}))}else e.$message.error(e.$t("DbBack.BackupsTips"))},GetDbConfig:function(){var e=this;this.messageShowLoad=!0,f({}).then((function(t){0==t.data.code&&(e.DbConfig=t.data.config,e.DbType=e.DbConfig.DbType,e.form.setFieldsValue({DbType:e.DbConfig.DbType.toString()}),0==e.DbType?setTimeout((function(){e.form.setFieldsValue({DbUserName:e.DbConfig.Mysqluser.toString(),DbPassword:e.DbConfig.Mysqlpwd.toString(),DbServer:e.DbConfig.Mysqlhost.toString(),DbServerPort:e.DbConfig.Mysqlport.toString(),DbName:e.DbConfig.Mysqldbname.toString()}),e.messageShowLoad=!1}),1e3):e.messageShowLoad=!1)})).catch((function(t){e.messageShowLoad=!1}))},SetDbConfig:function(){var e=this,t=this;this.form.validateFields((function(a){if(!a){var r={DbType:parseInt(e.form.getFieldValue("DbType"))};0==r.DbType&&(r.Mysqluser=e.form.getFieldValue("DbUserName"),r.Mysqlpwd=e.form.getFieldValue("DbPassword"),r.Mysqlhost=e.form.getFieldValue("DbServer"),r.Mysqlport=e.form.getFieldValue("DbServerPort"),r.Mysqldbname=e.form.getFieldValue("DbName")),e.Configuring=!0,D(r).then((function(e){0==e.data.code?(t.$message.success(t.$t("DbBack.ConfigureSuccess")),t.$router.push("/login")):-3==e.data.code?t.$message.error(t.$t("DbBack.DbConnectError")):t.$message.error(t.$t("DbBack.ConfigureFailed"))})).finally((function(e){t.Configuring=!1}))}}))},callback:function(e){"2"==e?this.GetBackUpList():"1"==e?this.GetTablesList():"3"==e&&this.GetDbConfig()},GetTablesList:function(){var e=this;this.messageShowLoad=!0,e.SystemTables=[],c().then((function(t){if(null==t.data.code){for(var a=0;a<t.data.list.length;a++)""!=t.data.list[a]&&e.SystemTables.push(t.data.list[a]);e.GetTables=e.SystemTables,e.checkAll=!0}})).finally((function(t){e.messageShowLoad=!1}))},GetBackUpList:function(){var e=this;this.messageShowLoad=!0,e.BackupList=[],u().then((function(t){0==t.data.code&&(e.BackupList=t.data.list)})).finally((function(t){e.messageShowLoad=!1}))},DbRestore:function(e){var t=this;this.messageShowLoad=!0,b({DbFilePath:e}).then((function(e){0==e.data.code?(t.$message.success(t.$t("DbBack.RestoreSuccess")),t.$router.push("/login")):t.$message.error(t.$t("DbBack.RestoreFailed"))})).finally((function(e){t.messageShowLoad=!1}))},beforeUpload:function(){this.$message.loading({content:this.$t("dataModel.opcuaModel.ImportNodeIDLoading"),duration:0})},localUpgradeCharge:function(e){this.dataSource=[];if(this.messageShowLoad=!0,"done"===e.file.status){var t=e.file.response;this.$message.destroy(),0==t.Code?(this.$message.success("".concat(e.file.name," ")+this.$t("SystemUpgrade.AuthUploadLoading")),this.$store.state.setting.IsOEM=t.Oem,window.location.reload()):-2==t.Code?this.$message.error("".concat(e.file.name," ")+this.$t("SystemUpgrade.UpgradeFileError")):this.$message.error("".concat(e.file.name," ")+this.$t("SystemUpgrade.UpgradeFileSaveError"))}else if("uploading"===e.file.status);else if("error"===e.file.status){this.$message.loading(this.$t("SystemUpgrade.BeginUpgradeLoading"),0),setTimeout((function(){location.reload()}),1e4)}this.messageShowLoad=!1},DbDown:function(e){var t=this;m({DbFilePath:e}).then((function(e){if(0==e.data.code){var a=document.createElement("a");a.href=e.data.path,a.target="_blank",document.body.appendChild(a),a.click(),document.body.removeChild(a)}else t.$message.error(t.$t("DbBack.RestoreFailed"))})).finally((function(e){t.messageShowLoad=!1}))}},watch:{}},y=(a("29f1"),a("2877")),v=Object(y.a)(S,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page-header-index-wide"},[a("a-card",{style:{height:"100%"},attrs:{bordered:!1,bodyStyle:{padding:"16px",height:"100%"}}},[a("a-tabs",{attrs:{"default-active-key":"3"},on:{change:e.callback}},[a("a-tab-pane",{key:"3",attrs:{tab:e.$t("DbBack.DbConfig")}},[a("a-spin",{attrs:{tip:e.$t("DbBack.Loading"),spinning:e.messageShowLoad}},[a("a-form",{attrs:{form:e.form,"label-col":{span:5},"wrapper-col":{span:12}}},[a("a-form-item",{attrs:{label:e.$t("DbBack.DbType")}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["DbType",{rules:[{required:!0,message:e.$t("DbBack.DbType")}]}],expression:"['DbType', { rules: [{ required: true, message: $t('DbBack.DbType') }] }]"}],on:{select:e.chargeDb}},[a("a-select-option",{attrs:{value:"1"}},[e._v(" Sqlite3 ")]),a("a-select-option",{attrs:{value:"0"}},[e._v(" Mysql ")])],1)],1),0==e.DbType?a("div",[a("a-form-item",{attrs:{label:e.$t("DbBack.DbServer")}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["DbServer",{rules:[{required:!0,message:e.$t("DbBack.DbServer")}]}],expression:"['DbServer', { rules: [{ required: true, message: $t('DbBack.DbServer') }] }]"}]})],1),a("a-form-item",{attrs:{label:e.$t("DbBack.DbServerPort")}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["DbServerPort",{rules:[{required:!0,message:e.$t("DbBack.DbServerPort")}]}],expression:"['DbServerPort', { rules: [{ required: true, message: $t('DbBack.DbServerPort') }] }]"}]})],1),a("a-form-item",{attrs:{label:e.$t("DbBack.DbName")}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["DbName",{rules:[{required:!0,message:e.$t("DbBack.DbName")}]}],expression:"['DbName', { rules: [{ required: true, message: $t('DbBack.DbName') }] }]"}]})],1),a("a-form-item",{attrs:{label:e.$t("DbBack.DbUserName")}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["DbUserName",{rules:[{required:!0,message:e.$t("DbBack.DbUserName")}]}],expression:"['DbUserName', { rules: [{ required: true, message: $t('DbBack.DbUserName') }] }]"}]})],1),a("a-form-item",{attrs:{label:e.$t("DbBack.DbPassword")}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["DbPassword",{rules:[{required:!0,message:e.$t("DbBack.DbPassword")}]}],expression:"['DbPassword', { rules: [{ required: true, message: $t('DbBack.DbPassword') }] }]"}],attrs:{type:"password"}})],1)],1):e._e(),a("a-form-item",{attrs:{"wrapper-col":{span:12,offset:5}}},[a("a-button",{attrs:{type:"primary","html-type":"submit",loading:e.Configuring},on:{click:e.SetDbConfig}},[e._v(" "+e._s(e.$t("DbBack.Sure"))+" ")])],1)],1)],1)],1),a("a-tab-pane",{key:"1",attrs:{tab:e.$t("DbBack.Backups")}},[a("a-spin",{attrs:{tip:e.$t("DbBack.BackingUp"),spinning:e.messageShowLoad}},[a("a-checkbox-group",{staticStyle:{"margin-bottom":"10px"},on:{change:e.onChange},model:{value:e.GetTables,callback:function(t){e.GetTables=t},expression:"GetTables"}},[a("a-row",e._l(e.SystemTables,(function(t,r){return a("a-col",{key:r,attrs:{span:8}},[a("a-checkbox",{attrs:{value:t}},[a("span",{staticStyle:{"font-size":"20px","font-weight":"400"}},[e._v(e._s(t))])])],1)})),1)],1),a("a-button",{attrs:{type:"default",loading:e.messageShowLoad},on:{click:e.BackUp}},[e._v(" "+e._s(e.$t("DbBack.Backups"))+" ")]),a("a-checkbox",{staticStyle:{"margin-left":"20px"},attrs:{indeterminate:e.indeterminate,checked:e.checkAll},on:{change:e.onCheckAllChange}},[e._v(" "+e._s(e.$t("DbBack.CheckAll"))+" ")])],1)],1),a("a-tab-pane",{key:"2",attrs:{tab:e.$t("DbBack.Restore")}},[a("a-upload",{attrs:{name:"file",multiple:!1,action:e.localUpgradeUrl,showUploadList:!1,beforeUpload:e.beforeUpload},on:{change:e.localUpgradeCharge}},[a("a-button",{attrs:{type:"default"}},[a("a-icon",{attrs:{type:"upload"}}),e._v(" "+e._s(e.$t("DbBack.BackupUpload"))+" ")],1)],1),a("a-spin",{attrs:{tip:e.$t("DbBack.Restoring"),spinning:e.messageShowLoad}},[a("a-table",{attrs:{rowKey:"FileName",pagination:e.pagination,columns:e.columns,"data-source":e.BackupList},scopedSlots:e._u([{key:"Opt",fn:function(t,r){return a("div",{},[a("a",{staticStyle:{cursor:"pointer",color:"#13C2C2"},attrs:{type:"link"},on:{click:function(t){return e.DbRestore(r.FilePath)}}},[a("a-icon",{attrs:{type:"reload"}}),a("span",{staticStyle:{"margin-left":"2px"}},[e._v(e._s(e.$t("DbBack.Restore")))])],1),a("a-divider",{attrs:{type:"vertical"}}),a("a",{staticStyle:{cursor:"pointer",color:"#13C2C2"},attrs:{type:"link"},on:{click:function(t){return e.DbDown(r.FilePath)}}},[a("a-icon",{attrs:{type:"download"}}),a("span",{staticStyle:{"margin-left":"2px"}},[e._v(e._s(e.$t("DbBack.download")))])],1)],1)}}])},[e._l(e.columns,(function(t,r){return a("template",{slot:t.slotName},[a("span",{key:r},[e._v(e._s(e.$t(t.slotName)))])])}))],2)],1)],1)],1)],1)],1)}),[],!1,null,"e3be491e",null);t.default=v.exports}}]);